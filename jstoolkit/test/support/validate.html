<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <script src="../../lib/jquery-1.3.2.js"></script>
  <script src="../testrunner.js"></script>
  <script src="../../build/js/CF_full_min.js"></script>
  <link rel="stylesheet" href="../testsuite.css" type="text/css" media="screen" />
  <script>

jQuery(function ()
{
	jQuery("input").val(""); //clear any values the browser has prepopped.
	
	test("Test required classname", function (){
		expect(2);
		var elem = jQuery('#testRequired1');
		var result = CF.validate.run(elem);
		ok(!result, "required validation expects failure");
		jQuery('#1').val("Hello");
		elem = jQuery('#testRequired1');
		result = CF.validate.run(elem);
		ok(result, "required validation expects success");
	})
	
	test("Test required attribute", function (){
		expect(2);
		var elem = jQuery('#testRequired2');
		var result = CF.validate.run(elem);
		ok(!result, "required validation expects failure");
		jQuery('#2').val("fakey@fake.fake");
		elem = jQuery('#testRequired2');
		result = CF.validate.run(elem);
		ok(result, "email validation expects success");
	})
	
	test("Test optional attribute", function (){
		expect(3);
		var elem = jQuery('#testOptionalEmail');
		var result = CF.validate.run(elem);
		ok(result, "optional");
		jQuery('#3').val("fakey@fake.fake");
		elem = jQuery('#testOptionalEmail');
		result = CF.validate.run(elem);
		ok(result, "email validation expects success");
		jQuery('#3').val("this is not an email");
		elem = jQuery('#testOptionalEmail');
		result = CF.validate.run(elem);
		ok(!result, "email validation expects failure");
	});
			
	test("Validator fail message", function (){
		expect(5);
		var elem = jQuery('#testValidatorFailMessage');
		var result = CF.validate.run(elem);
		ok(!result, "required");
		var failMsg = elem.find(".cf_validate_fail_msg");
		equals(failMsg.length, 1, "Failure messages found");
		equals(failMsg.html(), "I fail on you", "Fail message text");
		
		jQuery('#4').val("somebody@fake.fake");
		elem = jQuery('#testValidatorFailMessage');
		result = CF.validate.run(elem);
		ok(result, "email validation expects success");
		var failMsg = elem.find(".cf_validate_fail_msg");
		equals(failMsg.length, 0, "Failure messages clear on success");
	});
	
	test("Validator fail/success class", function (){
		expect(9);
		var elem = jQuery('#testValidatorFailClass');
		var result = CF.validate.run(elem);
		ok(!result, "required");
		var failMsg = elem.find(".cf_validate");
		ok(failMsg.hasClass("cf_validate_fail"), "Fail class applied");
		ok(!failMsg.hasClass("cf_validate_success", "Success class not set"));
	
		jQuery('#5').val("somebody@fake.fake");
		elem = jQuery('#testValidatorFailClass');
		result = CF.validate.run(elem);
		ok(result, "email validation expects success");
		failMsg = elem.find(".cf_validate");
		ok(!failMsg.hasClass("cf_validate_fail"), "Fail class removed");
		ok(failMsg.hasClass("cf_validate_success"), "Success class applied");
		
		jQuery('#5').val("");
		elem = jQuery('#testValidatorFailClass');
		result = CF.validate.run(elem);
		ok(!result, "required");
		failMsg = elem.find(".cf_validate");
		ok(failMsg.hasClass("cf_validate_fail"), "Fail class applied");
		ok(!failMsg.hasClass("cf_validate_success"), "Success class removed");
	});
	
	test("Custom validator", function (){
		expect(3);
		var myHelloValidator = function (v){
			if(v == "hello")
				return true;
			return false;
		}
		CF.validate.addValidator("custom", myHelloValidator);
		
		var elem = jQuery('#testCustomValidationFunc');
		var result = CF.validate.run(elem);
		ok(result, "validation succeeds because empty and not required");
		
		jQuery('#6').val("hello world");
		elem = jQuery('#testCustomValidationFunc');
		result = CF.validate.run(elem);
		ok(!result, "validation fails because empty not equals");
		
		jQuery('#6').val("hello");
		elem = jQuery('#testCustomValidationFunc');
		result = CF.validate.run(elem);
		ok(result, "validation passes");
		
	});
	
	test("regex inline validator", function (){
		expect(3);
		
		var elem = jQuery('#testRegexValidation');
		var result = CF.validate.run(elem);
		ok(result, "validation succeeds because empty and not required");
		
		jQuery('#7').val("www.yourmom.com");
		elem = jQuery('#testRegexValidation');
		result = CF.validate.run(elem);
		ok(!result, "validation fails because not valid url");
		
		jQuery('#7').val("http://www.yourmom.com");
		elem = jQuery('#testRegexValidation');
		result = CF.validate.run(elem);
		ok(result, "validation passes");
		
	});
	
	test("Multi-validate", function (){
		expect(4);
		
		var elem = jQuery('#testMultiValidate');
		var result = CF.validate.run(elem);
		ok(result, "validation succeeds because both empty and not required");
		
		jQuery('#8').val("12abc34");
		jQuery('#9').val("captaincook@pirates.org");
		
		elem = jQuery('#testMultiValidate');
		result = CF.validate.run(elem);
		ok(!result, "validation fails because not number");
		
		jQuery('#8').val("1234");
		jQuery('#9').val("captaincook at pirates.org");
		
		elem = jQuery('#testMultiValidate');
		result = CF.validate.run(elem);
		ok(!result, "validation fails because not email");
		
		jQuery('#8').val("1234");
		jQuery('#9').val("captaincook@pirates.org");
		
		elem = jQuery('#testMultiValidate');
		result = CF.validate.run(elem);
		ok(result, "validation succeeds because both valid");
		
	});
	
	
	test("Roll up events", function (){
		expect(5);
		var o = {fail:false}
		var callcount = 0;
		var evtListener = function (evt, elem)
		{
			if (evt == "validate_failed")
				o.fail= true	
			if (evt == "validate_success")
				o.fail= false;
			callcount++;
		}
		CF.validate.events.listen("validate_failed", evtListener);
		CF.validate.events.listen("validate_success", evtListener);
		
		var elem = jQuery('#testRollupEvents');
		var result = CF.validate.run(elem);
		ok(!o.fail, "validation succeeds because both empty and not required");
		
		jQuery('#10').val("12abc34");
		jQuery('#11').val("captaincook@pirates.org");
		
		elem = jQuery('#testRollupEvents');
		result = CF.validate.run(elem);
		ok(o.fail, "validation fails because not number");
		
		jQuery('#10').val("1234");
		jQuery('#11').val("captaincook at pirates.org");
		
		elem = jQuery('#testRollupEvents');
		result = CF.validate.run(elem);
		ok(o.fail, "validation fails because not email");
		
		jQuery('#10').val("1234");
		jQuery('#11').val("captaincook@pirates.org");
		
		elem = jQuery('#testRollupEvents');
		result = CF.validate.run(elem);
		ok(!o.fail, "validation succeeds because both valid");
		equals(callcount, 4, "Listener was called 4 times");
		
	});
	
	test("Individual events", function (){
		expect(13);
		var o = {fails:[], success:[]}
		var callcount = 0;
		var evtListener = function (evt, elem)
		{
			if (evt == "validate_elem_failed")
				o.fails.push(jQuery(elem).attr("id"));
			if (evt == "validate_elem_success")
				o.success.push(jQuery(elem).attr("id"));
			callcount++;
		}
		CF.validate.events.listen("validate_elem_failed", evtListener);
		CF.validate.events.listen("validate_elem_success", evtListener);
		
		var elem = jQuery('#testIndividualEvents');
		var result = CF.validate.run(elem);
		ok(result, "validation succeeds because both blank");
		equals(o.success[0], "12", "validation succeeds because number not required");
		equals(o.success[1], "13", "validation succeeds because email not required");
		o.success =[]; o.fails=[];
		
		jQuery('#12').val("12abc34");
		jQuery('#13').val("captaincook@pirates.org");
		elem = jQuery('#testIndividualEvents');
		result = CF.validate.run(elem);
		ok(!result, "validation fails because not number");
		equals(o.fails[0], "12", "validation fails because not number");
		equals(o.success[0], "13", "validation succeeds because valid email");
		o.success =[]; o.fails=[];
		
		jQuery('#12').val("1234");
		jQuery('#13').val("captaincook at pirates.org");
		
		elem = jQuery('#testIndividualEvents');
		result = CF.validate.run(elem);
		ok(!result, "validation fails because not email");
		equals(o.success[0], "12", "validation succeeds because number not required");
		equals(o.fails[0], "13", "validation fails because email not valid");
		o.success =[]; o.fails=[];
		
		
		jQuery('#12').val("1234");
		jQuery('#13').val("captaincook@pirates.org");
		
		elem = jQuery('#testIndividualEvents');
		result = CF.validate.run(elem);
		
		ok(result, "validation succeeds because both valid");
		equals(o.success[0], "12", "validation succeeds because number valid");
		equals(o.success[1], "13", "validation succeeds because email valid");
		o.success =[]; o.fails=[];
		
		equals(callcount, 8, "Listener was called 4 times");
		
	});
	
	test("Single elem validation", function (){
		expect(3);
		var elem = jQuery('#14');
		var result = CF.validate.run(elem);
		ok(result, "not required");
		elem.val("wowowowo");
		result = CF.validate.run(elem);
		ok(!result, "invalid number");
		elem.val("12");
		result = CF.validate.run(elem);
		ok(result, "valid number");
		});
			
	test("imageUrl validation", function (){
	expect(7);
	var elem = jQuery('#15');
	var result = CF.validate.run(elem);
	ok(result, "not required");
	elem.val("http://foo.bar/55.jpg");
	result = CF.validate.run(elem);
	ok(result, "valid image url");
	elem.val("http://foo.bar/55.JPG");
	result = CF.validate.run(elem);
	ok(result, "valid image url");
	elem.val("http://foo.bar/55.pdf");
	result = CF.validate.run(elem);
	ok(!result, "invalid valid image url (wrong extension)");
	elem.val("foo.bar/55.jpg");
	result = CF.validate.run(elem);
	ok(!result, "invalid valid image url (not url)");
	elem.val("http://www.foo.bar/super/cool/thing/my%20cool%20image.GiF");
	result = CF.validate.run(elem);
	ok(result, "valid valid image url");
	elem.val("http://www.foo.bar/super/cool/thing/my%20cool%20image.Png?test=bad");
	result = CF.validate.run(elem);
	ok(result, "valid valid image url (query string part of image url)");	
	});
			
				
});
	
//	test("Validator fail className message", function (){
//		expect(4);
//		var elem = jQuery('#testValidatorFailClass');
//		var result = CF.validate.run(elem);
//		ok(!result, "required");
//		var failMsg = elem.find(".cf_validator_fail_msg");
//		equals(failMsg.length, 1, "Failure messages found");
//		equals(failMsg.html(), "I fail on you", "Fail message text");
//		
//		jQuery('#4').val("this@that.theother");
//		elem = jQuery('#testOptionalEmail');
//		result = CF.validate.run(elem);
//		ok(result, "email validation expects success");
//		var failMsg = elem.find(".cf_validator_fail_msg");
//		equals(failMsg.length, 0, "Failure messages clear on success");
//	});
//	
//	
//	test("Validator fail message", function (){
//		expect(3);
//		var elem = jQuery('#testValidatorFailMessage');
//		var result = CF.validate.run(elem);
//		ok(!result, "required");
//		var failMsg = elem.find(".cf_validator_fail_msg");
//		equals(failMsg.length, 1, "Failure messages found");
//		equals(failMsg.html(), "I fail on you", "Fail message text");
//	})			
	
  </script>
	
</head>
<body>
  
 <h1>Validator Tests</h1>
 <h2 id="banner"></h2>
 <h2 id="userAgent"></h2>

 <ol id="tests"></ol>

 <div id="main"></div>
 
 <div class='testArea'>
	<div id='testRequired1'>
		<input id="1" class='cf_validate' validator='required' type='text'></input>
	</div>
	
	<div id='testRequired2'>
		<input id="2" class='cf_validate cf_required' validator='email' type='text'></input>
	</div>
		
	<div id='testOptionalEmail'>
		<input id="3" class='cf_validate' validator='email' type='text'></input>
	</div>
	
	<div id='testValidatorFailMessage'>
		<input id="4" class='cf_validate cf_required' validator='email' validator_msg='I fail on you' type='text'></input>
	</div>
	
	<div id='testValidatorFailClass'>
		<input id="5" class='cf_validate cf_required' validator='email' type='text'></input>
	</div>
	
	<div id='testCustomValidationFunc'>
		<input id="6" class='cf_validate' validator='custom' type='text'></input>
	</div>
	
	<div id='testRegexValidation'>
		<input id="7" class='cf_validate' 
			validator="/^(http|https|ftp):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i"
			validator_msg='Please enter a valid url' type='text'></input>
	</div>
	
	<div id='testMultiValidate'>
		<input id='8' class='cf_validate' validator='number' type='text'></input>
		<input id='9' class='cf_validate' validator='email' type='text'></input>
	</div>
	
	<div id='testRollupEvents'>
		<input id='10' class='cf_validate' validator='number' type='text'></input>
		<input id='11' class='cf_validate' validator='email' type='text'></input>
	</div>
	<div id='testIndividualEvents'>
		<input id='12' class='cf_validate' validator='number' type='text'></input>
		<input id='13' class='cf_validate' validator='email' type='text'></input>
	</div>
	
	<input id='14' class='cf_validate' validator='number'></input>
	
	<input id='15' class='cf_validate' validator='imageUrl'></input>
	
 </div>
 
 
</body>
</html>